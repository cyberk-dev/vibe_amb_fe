---
description: "Defines the high-level architectural patterns and best practices for this NextJS project, focusing on modularity, integrations, and maintainability. Apply when designing new features, structuring applications, or refactoring existing code."
globs: src/**/*.*
alwaysApply: false
---

# NextJS Project Architecture Standards

## Core Principles

- **Single Application Architecture**: The application is a standalone Next.js project with clear separation of concerns
- **Shared Components**: UI components are shared via the global `components/` directory to ensure consistency
- **Type Safety**: Strict TypeScript enforcement across all files
- **Component Architecture**: Container components handle business logic, presentation components handle UI
- **State Management**: Layered state management with Zustand for application state and React Query for server state
- **Co-location**: Page-specific resources (components) are co-located with their pages in `_components/`, `_containers/` directories

## Technology Stack

### Core Framework & Build Tools
- **Frontend**: Next.js 14+ with App Router
- **TypeScript**: Strict type checking enabled
- **Styling**: TailwindCSS for utility-first styling
- **Package Manager**: pnpm for efficient dependency management

### UI & Component Libraries
- **Component Library**: shadcn/ui components in shared `components/ui`
- **Form Handling**: React Hook Form with Zod validation schemas
- **Icons**: Lucide React or similar icon system

### State Management
- **Application State**: Zustand stores with persistence
- **Server State**: TanStack React Query for data fetching and caching
- **Form State**: React Hook Form for form-specific state

### Web3 & Blockchain (Optional)
- **Wallet Connection**: Reown AppKit for wallet connectivity
- **Blockchain Interaction**: Viem for low-level blockchain operations
- **React Integration**: Wagmi for React hooks and wallet management

### HTTP & API
- **HTTP Client**: Axios with custom configurations
- **API Organization**: Structured endpoint definitions and client setup

### Monitoring & Quality
- **Error Tracking**: Sentry for production error monitoring
- **Linting**: ESLint with shared configurations
- **Code Quality**: Prettier for consistent formatting

## Directory Structure & Purpose

### Application Structure
```plaintext
src/
├── app/                        # Next.js App Router directory
│   ├── (demo)/                 # Route groups for layout organization
│   │   ├── auth/               # Auth pages
│   │   │   ├── page.tsx        # Auth page component
│   │   │   ├── _components/    # Private presentation components
│   │   │   └── _containers/    # Private container components
│   │   ├── protected/          # Protected pages
│   │   │   ├── page.tsx        # Protected page component
│   │   │   ├── layout.tsx      # Protected-specific layout
│   │   │   ├── _components/    # Private presentation components
│   │   │   └── _containers/    # Private container components
│   │   └── todos/
│   │       ├── page.tsx        # Todos page component
│   │       ├── _components/    # Private presentation components
│   │       └── _containers/    # Private container components
│   ├── globals.css             # Global styles and Tailwind imports
│   ├── layout.tsx              # Root layout component
│   ├── page.tsx                # Home page component
│   └── not-found.tsx           # 404 page
├── components/                 # Global reusable components
│   ├── layout/                 # Layout-related components (header, footer, sidebar)
│   ├── auth/                   # Auth-related components (require-role, show-for-role)
│   ├── typography/             # Typography components
│   └── ui/                     # shadcn/ui components
├── hooks/                      # Global custom hooks
│   ├── auth/                   # Auth-related hooks
│   │   └── use-google-login.ts
│   ├── onchain/                # Blockchain-related hooks
│   │   ├── evm/                # EVM blockchain hooks
│   │   └── solana/             # Solana blockchain hooks
│   ├── use-auth-protected.ts   # Authentication protection hook
│   ├── use-confirm-dialog.ts   # Confirm dialog hook
│   ├── use-has-role.ts         # Role checking hook
│   └── use-wallet-info.ts      # Wallet information hook
├── integrations/               # Third-party integrations
│   ├── api/                    # API integration
│   │   ├── core/               # API core functionality
│   │   │   ├── client.ts       # Axios configuration
│   │   │   └── token-refresh.ts# Token refresh logic
│   │   ├── services/           # API service functions
│   │   │   ├── auth.ts         # Auth API functions
│   │   │   ├── user.ts         # User API functions
│   │   │   └── todo.ts         # Todo API functions
│   │   ├── hooks/              # React Query hooks
│   │   │   ├── auth/           # Auth query/mutation hooks
│   │   │   ├── user/           # User query/mutation hooks
│   │   │   └── todo/           # Todo query/mutation hooks
│   │   └── index.ts            # API exports
│   ├── fonts/                  # Font configurations
│   ├── react-intl/             # Internationalization
│   │   ├── localization-provider.tsx
│   │   └── messages.ts
│   ├── reown-appkit/           # Wallet connection (Reown AppKit)
│   │   ├── appkit-provider.tsx
│   │   ├── index.ts
│   │   └── siwe.ts
│   ├── smartcontracts/         # Smart contract integrations
│   │   ├── config.ts
│   │   └── token-factory/
│   └── tanstack-query/         # React Query configuration
│       └── persist-query-provider.tsx
├── stores/                     # Global Zustand stores
│   ├── auth-store.ts           # Authentication state
│   ├── controlled-store.ts     # Controlled store helper
│   ├── global-dialog-store.ts  # Global dialog state
│   ├── hydration.store.ts      # Hydration state
│   └── locale-store.ts         # Locale state
├── providers/                  # React context providers
│   ├── theme-provider.tsx      # Theme provider
│   └── web3-app-provider.tsx   # Web3 app provider
├── lib/                        # Application utilities and configurations
│   ├── configs/                # Application configurations
│   │   └── env.ts              # Environment variables validation
│   ├── constants/              # Application constants
│   │   └── roles.ts            # Role constants
│   ├── helpers/                # Helper functions
│   │   ├── datetime/           # Date/time helpers
│   │   ├── jwt/                # JWT helpers
│   │   ├── number/             # Number helpers
│   │   ├── string/             # String helpers
│   │   ├── validation/         # Validation helpers
│   │   └── rbac.ts             # RBAC helpers
│   ├── mocks/                  # Mock data for testing
│   ├── types/                  # TypeScript type definitions
│   │   ├── auth.types.ts       # Auth types
│   │   └── todo.types.ts       # Todo types
│   ├── utils.ts                # General utility functions (cn, etc.)
│   └── form-schemas.ts         # Zod validation schemas
```

## Critical Architecture Rules

### Page Organization
- **Server Components**: Use server components by default for pages (`app/{route}/page.tsx`)
- **Client Components**: Mark with `"use client"` when using hooks, state, or browser APIs
- **Co-location**: Keep page-specific resources in `_components/` and `_containers/` directories within the same route
- **Layouts**: Use `layout.tsx` files for shared layouts within route groups (e.g., `(demo)/protected/layout.tsx`)

### Component Architecture
- **Presentation Components**: Pure UI components in `_components/` directories (page-specific) or `components/` (global)
- **Container Components**: Business logic components in `_containers/` directories that use hooks, stores, and orchestrate presentation components
- **Shared Components**: Reusable components in global `components/` directory
- **Page Components**: Next.js pages in `app/**/page.tsx` - compose containers and handle routing

### State Management Rules
- **Local State**: Use `useState` for component-internal state
- **Page State**: Use page-specific stores in `_stores/` for complex page state
- **Global State**: Use global stores in `stores/` for app-wide state
- **Server State**: Use React Query hooks for all server data interactions
- **Form State**: Use React Hook Form with Zod schemas for form management

### Import Patterns
- **Absolute Imports**: Use `@/` alias for all app-level imports
- **Relative Imports**: Use relative imports only within the same directory or subdirectories
- **Type Imports**: Use `import type` for type-only imports to optimize bundle size

### API Organization
- **Client Configuration**: Centralize Axios configuration in `integrations/api/core/client.ts`
- **Service Functions**: Organize API functions in `integrations/api/services/` by domain (auth, user, todo, etc.)
- **React Query Hooks**: Wrap all API calls in React Query hooks in `integrations/api/hooks/` organized by domain
- **Type Safety**: Define API types co-located with service functions or in `lib/types/`
- **Error Handling**: Handle errors in React Query hooks with `onError` callbacks using toast notifications

### Environment & Configuration
- **Environment Variables**: Define in `.env.local` and validate in `lib/configs/env.ts`
- **Constants**: Centralize application constants in `lib/configs/constants.ts`
- **Feature Flags**: Use environment variables for feature toggles

### Testing Strategy
- **Component Testing**: Unit tests for shared UI components
- **Integration Testing**: Test page components with their associated hooks and stores
- **E2E Testing**: Test critical user flows across page boundaries
- **API Testing**: Mock API responses for consistent testing

## Dependency Flow Rules

- **Integrations** are independent: Each integration in `integrations/` is self-contained
- **Page-specific** resources stay local: `_components/` and `_containers/` within a route don't import from other routes' private directories
- **Global** resources are shared: `components/`, `hooks/`, `stores/`, `lib/` can be imported by any page or component
- **Containers** depend on hooks: Container components import and use custom hooks and stores
- **Presentations** receive props: Presentation components receive all data and callbacks via props
- **No circular dependencies**: Enforce strict unidirectional dependency flow

## Example Feature Structure

### User Profile Feature
```plaintext
src/app/(demo)/profile/
├── page.tsx                    # Server or client component page entry
├── layout.tsx                  # Profile-specific layout (optional)
├── _components/
│   ├── profile-form.tsx        # Presentation component (form UI)
│   ├── avatar-upload.tsx       # Presentation component (avatar UI)
│   └── profile-stats.tsx       # Presentation component (stats display)
└── _containers/
    ├── profile-form-container.tsx      # Container with form logic
    └── profile-dashboard-container.tsx # Container with dashboard logic
```

### Integration Structure Example
```plaintext
src/integrations/api/
├── core/
│   ├── client.ts               # Axios instance configuration
│   └── token-refresh.ts        # Token refresh interceptor
├── services/
│   ├── auth.ts                 # Auth API functions (login, register, etc.)
│   ├── user.ts                 # User API functions (getUsers, updateUser, etc.)
│   └── todo.ts                 # Todo API functions (getTodos, createTodo, etc.)
├── hooks/
│   ├── auth/
│   │   ├── use-login.mutation.ts       # Login mutation hook
│   │   └── use-register.mutation.ts    # Register mutation hook
│   ├── user/
│   │   ├── use-users-query.ts          # Users query hook
│   │   ├── use-promote-admin.mutation.ts
│   │   └── use-demote-admin.mutation.ts
│   └── todo/
│       ├── use-todos-query.ts          # Todos query hook
│       ├── use-create-todo-mutation.ts
│       ├── use-update-todo-mutation.ts
│       └── use-delete-todo-mutation.ts
└── index.ts                    # Export all hooks for easy imports
```